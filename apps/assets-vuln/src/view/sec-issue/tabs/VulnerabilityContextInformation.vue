<template>
    <a-modal v-if="!isInTab" title="漏洞上下文信息" @cancel="emits('update:open', false)" :width="600" footer="" class="vuln-context-modal">
        <a-collapse v-if="validData.length > 0" v-model:activeKey="activeKey" :bordered="false" accordion>
            <a-collapse-panel v-for="item in validData" :key="item.name" :header="item.name || '未命名上下文'">
                <div v-if="item.description && item.description !== ''" class="mt-1">
                    <span class="text-sm">描述：</span>
                    <p>{{ item.description || '-' }}</p>
                </div>
                <div v-if="item.context && item.context !== ''" class="mt-1">
                    <span class="text-sm">内容：</span>
                    <p>{{ item.context || '-' }}</p>
                </div>
            </a-collapse-panel>
        </a-collapse>
        <div v-else class="empty-data-tip py-[24px] text-center text-[#606266]">
            <svg class="inline-block mb-[8px]" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="#bfbfbf"/>
            </svg>
            <div class="text-[14px]">暂无漏洞上下文信息</div>
        </div>
    </a-modal>

    <!-- 在Tab内嵌模式下直接显示内容 -->
    <div v-else class="vuln-context-in-tab">
        <a-collapse v-if="validData.length > 0" v-model:activeKey="activeKey" :bordered="false" accordion>
            <a-collapse-panel v-for="item in validData" :key="item.name" :header="item.name || '未命名上下文'">
                <div v-if="item.description && item.description !== ''" class="context-item mt-2">
                    <div class="context-label text-[13px] text-[#606266] mb-1">描述：</div>
                    <div class="context-value text-[14px]">{{ item.description || '-' }}</div>
                </div>
                <div v-if="item.context && item.context !== ''" class="context-item mt-3">
                    <div class="context-label text-[13px] text-[#606266] mb-1">内容：</div>
                    <div class="context-value text-[14px]">{{ item.context || '-' }}</div>
                </div>
            </a-collapse-panel>
        </a-collapse>
        <div v-else class="empty-data-tip py-[24px] text-center text-[#606266]">
            <svg class="inline-block mb-[8px]" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="#bfbfbf"/>
            </svg>
            <div class="text-[14px]">暂无漏洞上下文信息</div>
        </div>
    </div>
</template>
<script lang="ts" setup>
import { ref, computed } from 'vue';

const { PropData, isInTab = false } = defineProps({
    PropData: {
        type: Array,
        default: () => [],
    },
    isInTab: {
        type: Boolean,
        default: false,
    },
});

// 确保数据是有效的
const validData = computed(() => {
    // 如果不是数组，返回空数组
    if (!Array.isArray(PropData) || PropData.length === 0) {
        return [];
    }

    // 过滤掉无效的项目
    return PropData.filter((item) => item && typeof item === 'object'
        && (item.name || item.description || item.context));
});

const emits = defineEmits(['update:open']);
const activeKey = ref([]);
</script>

<style lang="scss" scoped>
.vuln-context-in-tab {
    .context-item {
        padding: 0 0 12px 0;

        &:last-child {
            padding-bottom: 0;
        }
    }

    :deep(.ant-collapse) {
        background-color: transparent;
    }

    :deep(.ant-collapse-header) {
        padding: 12px 16px !important;
        background-color: #f8f9fa;
        border-radius: 4px !important;
    }

    :deep(.ant-collapse-content) {
        border-top: none;
        padding: 12px 0 0 0;

        .ant-collapse-content-box {
            padding: 8px 16px !important;
        }
    }
}

.empty-data-tip {
    color: #606266;
}
</style>
